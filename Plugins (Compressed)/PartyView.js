(()=>{const e=requireModule("node-fetch");var a=[],t={};const r=async a=>{if(!(r=t[a]))var r=player.connectedPlayers.find((e=>e.name==a))?.uuid;if(!r)var{id:r}=await(async(a,t)=>{var r=await e(a,void 0);r=await r.text();try{r=JSON.parse(r)}catch{}return r})(`https://api.mojang.com/users/profiles/minecraft/${a}`);return r};var i=null,l=toolbox.getConfigSync();const s=new toolbox.Item(4);s.displayName="§rParty View",s.lore=["","§7Use The Lunar Client Team View","§7Mod To See Your Party Members","","§7Current: §"+(l.modules.PartyView?"aEnabled":"cDisabled")];const o=new toolbox.PlayerModule("Party View","View Your Party Members With LC Team View",s,"PartyView");o.customCode=()=>{player.proxy.on("incoming",(async(e,i,s,o)=>{if("chat"==i.name){var n=JSON.parse(e.message);n.extra??=[];var y=[n.text,...n.extra.map((e=>e.text))].join("");if(y.endsWith("joined the party.")){c=(c=y.split(" ")).splice(c[0].startsWith("[")?1:0,c.length-(c[0].startsWith("[")?4:3)).join(" "),a.push(c);var m=await r(c);if(t[c]=m,l.modules.PartyView){if(!m)return;player.lcPlayer?.addTeammate(m)}}if(y.endsWith("left the party.")&&!y.startsWith("You")&&(c=(c=y.split(" ")).splice(c[0].startsWith("[")?1:0,c.length-(c[0].startsWith("[")?4:3)).join(" "),a=a.filter((e=>e!=c)),delete t[c],l.modules.PartyView)){if(!(m=await r(c)))return;player.lcPlayer?.removeTeammate(m)}if((y.includes("has disbanded the party!")||y.includes("You left the party."))&&(a=[],t={},player.lcPlayer?.removeAllTeammates()),y.includes("You have joined")&&y.includes("party!")&&setTimeout((()=>player.executeCommand("/party list")),1e3),y.includes("Party Leader:")&&(c=(c=y.split(" ")).splice(c[0].startsWith("[")?4:3,c.length-(c[0].startsWith("[")?5:4)).join(" "),a=[],player.lcPlayer?.removeAllTeammates(),a.push(c),m=await r(c),t[c]=m,l.modules.PartyView)){if(!m)return;player.lcPlayer?.addTeammate(m)}if(y.includes("Party Moderators:")||y.includes("Party Members:")){var d=y.split(" ");for(var c of(d=d.splice(2,d.length).join(" ").split("● ").map((e=>e.split(" ").splice(d[0].startsWith("[")?2:1,d.length-(d[0].startsWith("[")?2:1)).join(" "))),a.push(d),d))m=await r(c),t[c]=m;if(l.modules.PartyView)for(var c of d){if(!(m=await r(c)))return;player.lcPlayer?.addTeammate(m)}y.includes("Party Members:")&&(t=Object.keys(t).filter((e=>a.includes(e))).map((e=>t[e])))}y.includes("You are not currently in a party.")&&(a=[],t={},player.lcPlayer?.removeAllTeammates())}})),setInterval((async()=>{if(i=l,l=await toolbox.getConfig(),JSON.stringify(i)!=JSON.stringify(l))if(l.modules.PartyView)for(var e of(player.lcPlayer?.removeAllTeammates(),a)){var t=await r(e);if(!t)return;player.lcPlayer?.addTeammate(t)}else player.lcPlayer?.removeAllTeammates()}),500)},o.onLocationUpdate=()=>{setTimeout((()=>{l.modules.PartyView&&(player.lcPlayer?.removeAllTeammates(),setTimeout((async()=>{for(var e of a){var t=await r(e);if(!t)return;player.lcPlayer?.addTeammate(t)}}),500))}),1e3)},player.listener.on("player_join",((e,t)=>{l.modules.PartyView&&a.includes(t)&&e&&player.lcPlayer?.addTeammate(e)})),registerPlayerModule(o),registerPlugin({name:"Party View",description:"View Your Party Members With LC Team View | `/ss`",version:"1.4.3",author:"TBHGodPro"})})();