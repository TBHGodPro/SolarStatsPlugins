const getUUID=a=>player.connectedPlayers.find(b=>b.name==a)?.uuid,settingItem=new toolbox.Item(4);settingItem.displayName="\xa7rParty View",settingItem.lore=["","\xa77Use The Lunar Client Team View","\xa77Mod To See Your Party Members","",`\xa77Current: \xa7${toolbox.getConfigSync().modules.PartyView?"aEnabled":"cDisabled"}`];const module=new toolbox.PlayerModule("Party View","View Your Party Members With LC Team View",settingItem,"PartyView");var oldConfig=null,config=toolbox.getConfigSync(),partyMembers=[];module.customCode=()=>{player.proxy.on("incoming",(f,g,h,i)=>{if("chat"==g.name){var e=JSON.parse(f.message);e.extra??=[];var b=[e.text,...e.extra.map(a=>a.text)].join("");if(b.endsWith("joined the party.")){var a=b.split(" ");if(a=a.splice(a[0].startsWith("[")?1:0,a.length-(a[0].startsWith("[")?4:3)).join(" "),partyMembers.push(a),config.modules.PartyView){var c=getUUID(a);if(!c)return;player.lcPlayer?.addTeammate(c)}}if(b.endsWith("left the party.")&&!b.startsWith("You")){var a=b.split(" ");if(a=a.splice(a[0].startsWith("[")?1:0,a.length-(a[0].startsWith("[")?4:3)).join(" "),partyMembers=partyMembers.filter(b=>b!=a),config.modules.PartyView){var c=getUUID(a);if(!c)return;player.lcPlayer?.removeTeammate(c)}}if((b.includes("has disbanded the party!")||b.includes("You left the party."))&&(partyMembers=[],player.lcPlayer?.removeAllTeammates()),b.includes("You have joined")&&b.includes("party!")&&setTimeout(()=>player.executeCommand("/p list"),1e3),b.includes("Party Leader:")){var a=b.split(" ");if(a=a.splice(a[0].startsWith("[")?4:3,a.length-(a[0].startsWith("[")?5:4)).join(" "),partyMembers=[],player.lcPlayer?.removeAllTeammates(),partyMembers.push(a),config.modules.PartyView){var c=getUUID(a);if(!c)return;player.lcPlayer?.addTeammate(c)}}if(b.includes("Party Moderators:")||b.includes("Party Members:")){var d=b.split(" ");if(d=d.splice(2,d.length).join(" ").split("\u25CF ").map(a=>a.split(" ").splice(d[0].startsWith("[")?2:1,d.length-(d[0].startsWith("[")?2:1)).join(" ")),(partyMembers=[]).push(d),config.modules.PartyView)for(var a of d){var c=getUUID(a);if(!c)return;player.lcPlayer?.addTeammate(c)}}b.includes("You are not currently in a party.")&&(partyMembers=[],player.lcPlayer?.removeAllTeammates())}}),setInterval(async()=>{oldConfig=config,config=await toolbox.getConfig(),JSON.stringify(oldConfig)!=JSON.stringify(config)&&(config.modules.PartyView?(player.lcPlayer?.removeAllTeammates(),partyMembers.forEach(b=>{var a=getUUID(b);a&&player.lcPlayer?.addTeammate(a)})):player.lcPlayer?.removeAllTeammates())},500)},player.listener.on("switch_server",()=>{config.modules.PartyView&&(player.lcPlayer?.removeAllTeammates(),partyMembers.forEach(b=>{var a=getUUID(b);a&&player.lcPlayer?.addTeammate(a)}))}),player.listener.on("player_join",(a,b)=>{config.modules.PartyView&&partyMembers.includes(b)&&a&&player.lcPlayer?.addTeammate(a)}),registerPlayerModule(module),registerPlugin({name:"Party View",description:"View Your Party Members With LC Team View | `/ss`",version:"1.4.1",author:"TBHGodPro"})