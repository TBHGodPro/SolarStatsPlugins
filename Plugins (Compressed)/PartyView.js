(()=>{const e=requireModule("node-fetch");var a=[],t={};function r(e){return{uuid:e}}async function i(a){var r=t[a];return r||(r=player.connectedPlayers.find((e=>e.name==a))?.uuid),r||(r=(await(async(a,t)=>{var r=await e(a,void 0);r=await r.text();try{r=JSON.parse(r)}catch{}return r})(`https://api.mojang.com/users/profiles/minecraft/${a}`)).id),r}var l=toolbox.getConfigSync().modules.PartyView;const s=new toolbox.Item(4);s.displayName="§rParty View",s.lore=["","§7Use The Lunar Client Team View","§7Mod To See Your Party Members","","§7Current: §"+(l?"aEnabled":"cDisabled")];const n=new toolbox.PlayerModule("Party View","View Your Party Members With LC Team View",s,"PartyView");n.customCode=()=>{player.proxy.on("incoming",(async(e,s,n,o)=>{if("chat"==s.name){var y=JSON.parse(e.message);y.extra??=[];var m=[y.text,...y.extra.map((e=>e.text))].join("");if(m.endsWith("joined the party.")){u=(u=m.split(" ")).splice(u[0].startsWith("[")?1:0,u.length-(u[0].startsWith("[")?4:3)).join(" "),a.push(u);var c=await i(u);if(t[u]=c,l){if(!c)return;player.lcPlayer?.addTeammate(r(c))}}if(m.endsWith("left the party.")&&!m.startsWith("You")&&(u=(u=m.split(" ")).splice(u[0].startsWith("[")?1:0,u.length-(u[0].startsWith("[")?4:3)).join(" "),a=a.filter((e=>e!=u)),delete t[u],l)){if(!(c=await i(u)))return;player.lcPlayer?.removeTeammate(r(c))}if((m.includes("has disbanded the party!")||m.includes("You left the party."))&&(a=[],t={},player.lcPlayer?.removeAllTeammates()),m.includes("You have joined")&&m.includes("party!")&&setTimeout((()=>player.executeCommand("/party list")),1e3),m.includes("Party Leader:")&&(u=(u=m.split(" ")).splice(u[0].startsWith("[")?4:3,u.length-(u[0].startsWith("[")?5:4)).join(" "),a=[],player.lcPlayer?.removeAllTeammates(),a.push(u),c=await i(u),t[u]=c,l)){if(!c)return;player.lcPlayer?.addTeammate(r(c))}if(m.includes("Party Moderators:")||m.includes("Party Members:")){var d=m.split(" ");for(var u of(d=d.splice(2,d.length).join(" ").split("● ").map((e=>e.split(" ").splice(d[0].startsWith("[")?2:1,d.length-(d[0].startsWith("[")?2:1)).join(" "))),a.push(d),d))c=await i(u),t[u]=c;if(l)for(var u of d){if(!(c=await i(u)))return;player.lcPlayer?.addTeammate(r(c))}m.includes("Party Members:")&&(t=Object.keys(t).filter((e=>a.includes(e))).map((e=>t[e])))}m.includes("You are not currently in a party.")&&(a=[],t={},player.lcPlayer?.removeAllTeammates())}}))},n.onConfigChange=async e=>{if(l=e)for(var t of(player.lcPlayer?.removeAllTeammates(),a)){var s=await i(t);if(!s)return;player.lcPlayer?.addTeammate(r(s))}else player.lcPlayer?.removeAllTeammates()},n.onLocationUpdate=()=>{setTimeout((()=>{l&&(player.lcPlayer?.removeAllTeammates(),setTimeout((async()=>{for(var e of a){var t=await i(e);if(!t)return;player.lcPlayer?.addTeammate(r(t))}}),500))}),1e3)},player.listener.on("player_join",((e,t)=>{l&&a.includes(t)&&e&&player.lcPlayer?.addTeammate(r(e))})),registerPlayerModule(n),registerPlugin({name:"Party View",description:"View Your Party Members With LC Team View | `/ss`",version:"1.4.3",author:"TBHGodPro"})})();